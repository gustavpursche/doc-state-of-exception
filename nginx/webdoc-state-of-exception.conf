location ~ /stories/state-of-exception/?$ {
  set $language 'en';

  #if ( $http_accept_language ~* 'en' ) {
  #  set $language 'en';
  #}

  return 301 /stories/state-of-exception/$language/;
}

location ^~ /stories/state-of-exception/(?<language>[a-zA-Z]+)/$ {
  set $proxy_url https://cdn.jib-collective.net/state-of-exception/dist/markup/en/index.html;

  if ( $language == 'de' ) {
    set $proxy_url https://cdn.jib-collective.net/state-of-exception/dist/markup/de/index.html;
  }

  resolver                   8.8.8.8;
  resolver_timeout           5s;

  proxy_ssl_server_name      on;
  proxy_pass                 $proxy_url;
  proxy_pass_request_headers on;
  proxy_buffering            off;
  proxy_hide_header          x-amz-id-2;
  proxy_hide_header          x-amz-request-id;
  proxy_hide_header          X-Amz-Cf-Id;
}
